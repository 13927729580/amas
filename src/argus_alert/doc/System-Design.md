# 系统设计
----

## Python版本
- Python3


## 模块功能设计

### 查询器
1. 从数据库查询指标结果，比对阈值
2. 支持对接几种主流的监控存储数据库（OpenTSDB，InfluxDB，GraphiteDB，Mysql...）

### 告警策略定义
1. 从数据库中拉取告警定义
2. 编写自定义策略的python脚本（远离DSL语言定义规则/DevOps时代开发运维不分家好吧）
3. 告警分级策略：全局、组、主机策略，高中低重要性
4. 告警自愈策略
5. 告警通知方法
6. 告警策略定义，首先支持字段组合、再支持直接以opentsdb查询url的payload的定义
7. 支持策略模板管理（继承）
8. 动态调整阈值的接口


### 通知处理
1. 多种通知渠道（入库、微信、邮件、短信、API回调...）
2. 权限和对象管理
3. 通知消息模板
4. 支持socketio的web实时告警推送

### 状态管理
1. 管理告警信息的全局状态（策略定义-结果查询-告警产生-告警生命周期）
2. 告警生命周期（首次告警，中间连续告警，告警恢复）
3. 聚合模块：过滤、智能收敛

### REST接口
1. 提供前后端分离的RESTful风格 API
    - 手动触发告警的接口（代码层、日志分析模块使用）
2. 提供完善的接口文档（代码生成）
3. 支持OAuth认证


## Docker
1. 需要支持Dockerfile的构建交付方式
2. 告警模块，需要支持docker化运行，可通过docker水平扩展、伸缩告警处理能力

## 序列化
1. 尽量采用json序列化
2. 如果需要，可以考虑采用其他更高效的序列化（如Protocolbuf）

## 部署
- 考虑是否支持部署在Mesos之上，可以让整个监控（和tsd）方便部署在同一平台

## DSL设计
- 设计开发告警规则的DSL

## 可用性设计
- driver支持zk/etcd

## 机器学习技术落地
- 动态阈值
- 智能去重、聚合告警信息